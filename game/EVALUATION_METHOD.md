# AI Route Battle 評価手法ドキュメント

## 概要

本システムでは、JR山手線大崎駅からアートヴィレッジ大崎セントラルタワー5階のFindyオフィスまでのルート案内について、AIの出力を自動評価する仕組みを実装しています。

## 正解データ

評価基準となる正解データは `/data/ans.md` に記載されており、以下の要素を含みます：

### 基本情報
- **目的地**: アートヴィレッジ大崎セントラルタワー 5階
- **所要時間**: 約5分
- **特徴**: 雨に濡れずに到着可能

### 正確なルート手順
1. 北改札口を出て、東口方面へ向かう
2. NewDays（コンビニ）を正面に見て右折
3. 突き当たりを左折し、そのまま直進
4. エスカレーターを下る
5. 降りた先、左斜め前方の通路を進む
6. 次のエスカレーターで上へ
7. 開けた場所に出たら右手前方向へ進む
8. 分岐点を左に進み、直進
9. 左手最初のビル「アートヴィレッジ大崎セントラルタワー」に到着

### 重要な付加情報
- エレベーター: 中央のエレベーターを使用
- 受付: iPadから担当者を呼び出し
- 待機場所: Findy Blueのソファ
- 夜間対応: 20時以降は電話連絡が必要（070-2262-9553）

## 評価システム

### 総合評価
- **満点**: 100点
- **正規化**: 10点満点に変換
- **4つのカテゴリ**: 基本情報、ルート正確性、時間正確性、重要詳細情報

### カテゴリ別評価

#### 1. 基本情報（20点満点）
**評価項目:**
- ビル名の正確性（10点）
  - 「アートヴィレッジ大崎セントラルタワー」または類似表記
  - 「アートビレッジ」「Art Village」等の表記も評価対象
- フロア情報（10点）
  - 「5階」「5F」「Fifth Floor」等の表記

**採点基準:**
```javascript
// ビル名評価
if (output.includes("アートヴィレッジ大崎セントラルタワー") || 
    output.includes("アートビレッジ") || 
    output.includes("art village")) {
    score += 10
}

// フロア評価
if (output.includes("5階") || 
    output.includes("5f") || 
    output.includes("fifth floor")) {
    score += 10
}
```

#### 2. ルート正確性（40点満点）
**評価キーワード:**
- 北改札（5点）
- 東口（5点）
- NewDays（5点）
- エスカレーター（5点）
- 左折（5点）
- 右折（5点）
- 直進（5点）

**採点基準:**
- 各キーワードが含まれている場合に5点加算
- 最大40点まで（8キーワード × 5点）

#### 3. 時間正確性（15点満点）
**評価基準:**
- **満点（15点）**: 4-6分の範囲
- **良好（10点）**: 3-8分の範囲
- **普通（5点）**: 時間情報はあるが範囲外

**採点ロジック:**
```javascript
const timeMatch = output.match(/(\d+)分/)
if (timeMatch) {
    const mentionedTime = parseInt(timeMatch[1])
    if (mentionedTime >= 4 && mentionedTime <= 6) {
        score += 15  // 正確
    } else if (mentionedTime >= 3 && mentionedTime <= 8) {
        score += 10  // おおよそ正しい
    } else {
        score += 5   // 時間情報のみ
    }
}
```

#### 4. 重要詳細情報（25点満点）
**評価項目:**
- 雨情報（5点）: 「雨に濡れない」情報
- 中央エレベーター（5点）: 「中央」エレベーターの記載
- 受付iPad（5点）: 「iPad」での呼び出し情報
- 待機場所（5点）: 「Findy Blue」の記載
- 夜間対応（5点）: 「20時」以降の特別対応情報

## 評価結果の表示

### スコア表示形式
```
総合スコア: XX/10点
詳細スコア: XX/100点
```

### カテゴリ別内訳
各カテゴリごとに以下を表示：
- スコア: 獲得点数/満点
- プログレスバー: 達成率の視覚表示
- 獲得項目一覧: 評価された具体的な項目

### 色分け基準
- **成功（緑）**: 80%以上
- **警告（黄）**: 60%以上80%未満  
- **エラー（赤）**: 60%未満

## 実装ファイル

### バックエンド
- `backend/answerData.js`: 評価ロジックの実装
- `backend/server.js`: API エンドポイント

### フロントエンド
- `frontend/src/components/EvaluationDetails.jsx`: 評価結果表示コンポーネント
- `frontend/src/hooks/useSocket.js`: 評価データ管理

## API仕様

### 評価API
```http
POST /api/evaluate-route
Content-Type: application/json

{
  "aiOutput": "AIの出力テキスト",
  "model": "使用したAIモデル名"
}
```

### レスポンス
```json
{
  "evaluation": {
    "totalScore": 85,
    "maxScore": 100,
    "normalizedScore": 9,
    "categories": {
      "basicInfo": {
        "score": 20,
        "maxScore": 20,
        "items": ["正しいビル名を記載", "正しいフロア情報"]
      },
      "routeAccuracy": {
        "score": 35,
        "maxScore": 40,
        "items": ["重要なルート情報: 北改札", "重要なルート情報: 東口", ...]
      },
      "timeAccuracy": {
        "score": 15,
        "maxScore": 15,
        "items": ["正確な所要時間（約5分）"]
      },
      "keyDetails": {
        "score": 15,
        "maxScore": 25,
        "items": ["雨に濡れない情報", "中央エレベーター情報", ...]
      }
    }
  },
  "suggestedScore": 9
}
```

## 今後の拡張可能性

### 評価精度の向上
- 自然言語処理による意味解析
- 機械学習モデルによる評価
- ユーザーフィードバックを活用した学習

### 評価項目の追加
- ルートの効率性評価
- 説明の分かりやすさ評価
- アクセシビリティ情報の評価

### 多言語対応
- 英語、中国語、韓国語等での評価
- 多言語キーワード辞書の構築